{% extends 'base.html.twig' %}

{% block title %}Statistics{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js">
{% endblock %}

{% block body %}
    <h1>Statistics for {{ user.nom }} {{ user.prenom }}</h1>

    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title">Donut Chart</h3>
        </div>
        <div class="box-body">
            <div class="chart">
                <canvas id="donutChart" style="height: 250px;"></canvas>
            </div>
        </div>
    </div>

    <script>
        var ctx = document.getElementById('donutChart').getContext('2d');
        var statistics = {{ statistics|json_encode|raw }}; // Pass statistics data to JavaScript

        // Process statistics data for Chart.js
        var chartData = [];
        for (var monthYear in statistics) {
            chartData.push({
                label: monthYear,
                value: statistics[monthYear].totalScores,
            });
        }

        var chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: chartData.map(data => data.label),
                datasets: [{
                    data: chartData.map(data => data.value),
                    backgroundColor: getRandomColors(chartData.length),
                }],
            },
        });

        // Generate random colors
        function getRandomColors(count) {
            var colors = [];
            for (var i = 0; i < count; i++) {
                colors.push('#' + Math.floor(Math.random() * 16777215).toString(16));
            }
            return colors;
        }
    </script>
{% endblock %}